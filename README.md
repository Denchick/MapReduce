# Внешняя сортировка

Версия 0.2

Автор: Волков Денис (denchick1997@mail.ru)

## Описание

Данная утилита может быть использована для сортировки файлов, не помещающихся в оперативную память и состоящих из чисел или строк. При этом, есть возможность установления параметров сортировки (в обратном порядке, без учета регистра, etc.).

## Требования

* Python 3;
* Модули psutil и shutil;

## Состав

* Генератор случайных строк: `generators/numbers_generator.py`
* Генератор случайных чисел `generators/strings_generator.py`
* Утилита сортировки: `sorter.py`
* Необходимые модули `map_reduce/`
* Тесты: `tests/`

Для запуска тестов можно использовать `runtest.sh` (нужен `bash`, `coverage3`).

## Запуск

Справка по запуску: `./sorter.py --help`

Пример запуска: 

```
./generators/numbers_generator.py -o big.txt -c 1000
./sorter.py -o output.txt -s "\n" big.txt
```

где `big.txt` - файл, который необходимо отсортировать с `\n` в качестве разделителя между значениями.

## Подробности реализации

В основе реализации лежит алгоритм [MapReduce](https://en.wikipedia.org/wiki/MapReduce), в котором большой файл разбивается на маленькие(каждый из которых возможно уместить в оперативную память), данные внутри каждого куска сортируются, а потом все фрагменты сливаются в одно целое. Модули, отвечающие за сортировку, находятся в пакете `map_reduce`. За сущность "кусочек" отвечает модуль `piece.Piece`. 

На модули `piece`, `utils`, `map_reduce` написаны тесты, их можно найти в `tests/`.

## Что предстоит сделать
* ~~Добавить возможность для sorter.py принимать данные из stdin~~
* Пока не поддерживается работа с csv-таблицами
* Переделать работу argparse в sorter.py на 3 subprocess
* *Дописать тесты на map_reduce, отрефакторить test_piece, test_utils* - частично сделано
* ~~Настроить работу генераторов, добавить модуль logging~~ 
* ~~Задокумментировать код.~~
* ~~Исправить debug() на модуль logging в map_reduce~~
* ~~Добавить возможность указания максимальный размер «памяти», в котором можно сортировать с использованием sorted~~
* Исправление некоторых багов. Например, для разделителей длины больше 1 утилита работает некорректно и др.
* ~~Добавить в документацию комментарии о выборе размера одного куска~~